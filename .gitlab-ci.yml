stages:
  - install-and-build
  - test
  - cleanup

variables:
  BUILD_DIR: "build"
  CMAKE_ARGS: "-DCMAKE_BUILD_TYPE=Release"
  MAKE_ARGS: "-j$(nproc)"

install-and-build:
  stage: install-and-build
  image: ubuntu:latest
  before_script:
    - apt-get update
    - apt-get install -y curl build-essential cmake git unzip libssl-dev libboost-all-dev libsqlite3-dev
  script:
    - chmod +x ./install.sh
    - ./install.sh --enable-tests

test:
  stage: test
  image: gcc:latest
  script:
    - cd $BUILD_DIR
    - ctest --output-on-failure
  dependencies:
    - install-and-build

cleanup:
  stage: cleanup
  script:
    - rm -rf $BUILD_DIR